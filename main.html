<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>BashaMole</title>

    <!-- WinJS references -->
    <link href="//Microsoft.WinJS.1.0/css/ui-dark.css" rel="stylesheet" />
    <script src="//Microsoft.WinJS.1.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.1.0/js/ui.js"></script>

    <!-- CreateJS references -->
    <script src="js/easeljs-0.5.0.min.js"></script>

    <!-- BashaMole references -->
    <link href="/css/default.css" rel="stylesheet" />
    <script src="/js/default.js"></script>
    <script src="/js/appbar.js"></script>

    <script>
        var canvas;
        var stage;

        //Initial mole position
        var molePosX = new Array();
        var molePosY = new Array();
        var moleShowing = new Array();
        var moleShowTime;
        var numberOfMoles;
        var maxMoleCols = 3;
        var maxMoleRows = 1;
        var moleShape = new Array();
        var init 

        function init() {
            canvas = document.getElementById("canvas");
            canvas.height = window.innerHeight;
            canvas.width = window.innerWidth;

            stage = new createjs.Stage(canvas);

            initialiseMolePosition();

            createjs.Ticker.addListener(window);
        };

        function tick() {

            moleShowTime--;
            if (moleShowTime <= 0) {
                showNewMole()
                moleShowTime = Math.floor(Math.random() * 10 + 1);
            }

            for (idx = 0; idx < numberOfMoles; idx++) {
                if (moleShowing[idx] > 0) {
                    moleShowing[idx]--;
                    if (moleShowing[idx] <= 0) {
                        stage.removeChild(moleShape[idx]);
                    }
                }
            }

            stage.update();
        }

        function showNewMole() {
            var moleNum = Math.floor(Math.random() * numberOfMoles);
            
            if (moleShowing[moleNum] == 0) {
                getMole(moleNum);
                moleShowing[moleNum] = 5;
            }
        }

        function getMole(moleIndex) {

            moleShape[moleIndex] = new createjs.Shape();
            var g = moleShape[moleIndex].graphics;
            g.beginFill("red");
            g.drawCircle(molePosX[moleIndex], molePosY[moleIndex], 50);

            stage.addChild(moleShape[moleIndex]);
        }

        function initialiseMolePosition() {
            var stepX = canvas.width / (maxMoleCols + 1);
            var curX = stepX;
            var stepY = canvas.height / (maxMoleRows + 1);
            var curY = stepY;

            var idx = 0;
            for (y = 0; y < maxMoleRows; y++) {
                for (x = 0; x < maxMoleCols; x++) {
                    molePosX[idx] = curX;
                    molePosY[idx] = curY;
                    moleShowing[idx] = 0;

                    curX += stepX;
                    idx++;
                }

                curY += stepY;
                curX = stepX;
            }

            numberOfMoles = idx ;
            moleShowTime = Math.floor(Math.random() * 10 + 1);
        }

    </script>
</head>
<body onload="init()">
    <img src="images/title.png" id="title" />
    <img src="images/background.png" id="background" />

    <div> <canvas id="canvas"></canvas></div>

    <div id="appBar" data-win-control="WinJS.UI.AppBar" data-win-options="">
        <button 
            data-win-control="WinJS.UI.AppBarCommand" 
            data-win-options="{id:'cmdDelete',label:'End Game',icon:'delete',
                section:'global',tooltip:'Delete item'}">
        </button>
     </div>

    <div id="statusMessage"></div>
</body>
</html>
